{"version":3,"sources":["webpack:///./node_modules/rxjs-compat/_esm5/add/operator/do.js","webpack:///./node_modules/rxjs-compat/_esm5/operator/do.js","webpack:///./src/app/modules/permissions/components/permission-listing/permission-listing.component.html","webpack:///./src/app/modules/permissions/components/permission-listing/permission-listing.component.scss","webpack:///./src/app/modules/permissions/components/permission-listing/permission-listing.component.ts","webpack:///./src/app/modules/permissions/permissions.module.ts","webpack:///./src/app/modules/permissions/permissions.routing.ts","webpack:///./src/app/shared/http/interceptor/interceptor.ts"],"names":[],"mappings":"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","file":"modules-permissions-permissions-module.js","sourcesContent":["import { Observable } from 'rxjs';\nimport { _do } from '../../operator/do';\nObservable.prototype.do = _do;\nObservable.prototype._do = _do;\n//# sourceMappingURL=do.js.map","import { tap as higherOrder } from 'rxjs/operators';\nexport function _do(nextOrObserver, error, complete) {\n    return higherOrder(nextOrObserver, error, complete)(this);\n}\n//# sourceMappingURL=do.js.map","module.exports = \"<form *ngIf=\\\"dataLoaded\\\" class=\\\"card\\\" [formGroup]=\\\"dataForm\\\" novalidate (ngSubmit)=\\\"submit(dataForm)\\\">\\n  <div class=\\\"card-header\\\">\\n    <h3 class=\\\"card-title\\\">Permissions</h3>\\n    <div class=\\\"card-options\\\">\\n        <button type=\\\"submit\\\" class=\\\"btn btn-primary\\\">Save Changes</button>\\n    </div>\\n  </div>\\n  <div class=\\\"table-responsive\\\">\\n    <table class=\\\"table table-bordered table-hover table-sm mb-0\\\">\\n      <thead>\\n        <tr>\\n          <th class=\\\"w-1\\\" class=\\\"text-center\\\">#</th>\\n          <th width=\\\"40%\\\">Name</th>\\n          <th *ngFor=\\\"let item of currentPermissions\\\" class=\\\"text-center\\\">{{ item.label }}</th>\\n        </tr>\\n      </thead>\\n      <tbody >\\n        <tr *ngFor=\\\"let item of permissionList; let i= index\\\" >\\n          <td class=\\\"text-center\\\">{{ i+1 }}.</td>\\n          <td>{{ item.label }}</td>\\n          <td *ngFor=\\\"let role of currentPermissions\\\">\\n            <div [formArrayName]=\\\"convertHyphenUnderscore(role.name)\\\" class=\\\"text-center\\\">\\n                <input type=\\\"checkbox\\\" [formControlName]=\\\"i\\\" >\\n            </div>              \\n          </td>\\n        </tr>\\n      </tbody>\\n    </table>\\n  </div>\\n</form>\"","module.exports = \"\"","import { Component, OnInit, Input, Output, EventEmitter } from '@angular/core';\nimport { FormGroup, FormControl, FormBuilder, FormArray } from '@angular/forms';\nimport { HttpClient } from '@angular/common/http';\nimport { BASE_URL, ApplicationConstant } from '../../../../shared/constants/constant';\nimport { ObjIteratorPipe } from '../../../../shared/shared-services-and-components-module/pipes/obj-iterator.pipe';\n\n@Component({\n  selector: 'app-permission-listing',\n  templateUrl: './permission-listing.component.html',\n  styleUrls: ['./permission-listing.component.scss'],\n  providers: [ObjIteratorPipe]\n})\nexport class PermissionListingComponent implements OnInit {\n\n  @Output() formResult: EventEmitter<any> = new EventEmitter<any>();\n\n  public dataForm: FormGroup;\n  private endPoint: string;\n  public permissionList = [];\n  public permissionNameList = [];\n  public currentPermissions = [];\n  public dataLoaded = false;\n\n  constructor(private formBuilder: FormBuilder, private http: HttpClient, private objectIterator: ObjIteratorPipe) {\n    this.endPoint = BASE_URL + ApplicationConstant.PERMISSIONS;\n  }\n\n  ngOnInit() {\n    this.getAllAssignedPermissions();\n  }\n\n  /**\n   * Get all resources\n   */\n  private getAllAssignedPermissions() {\n    this.http.get(this.endPoint).subscribe(\n      res => {\n        this.permissionList = this.objectIterator.transform(res['master']);\n        this.currentPermissions = this.objectIterator.transform(res['currentPermissions']);\n        this.permissionNameList = res['masterNames'];\n        this.setFormGroup();\n        this.dataLoaded = true;\n      }\n    );\n  }\n\n  /**\n   * Submit data\n   * @param dataForm\n   */\n  public submit(dataForm) {\n    let object = this;\n    let data = {};\n\n    this.currentPermissions.forEach(function (role) {\n      let label = object.convertHyphenUnderscore(role.name);\n      data[label] = object.convertToValue(label);\n    });\n\n    this.http.post(this.endPoint, data).subscribe(res => {\n      this.formResult.emit(res);\n    });\n  }\n\n  /**\n   * Convert hypen or white space to underscore\n   * @param value\n   */\n  public convertHyphenUnderscore(value) {\n    return value.replace(/-/g, '_');\n  }\n\n  /**\n   * Convert permission id to permission value\n   * @param key\n   */\n  convertToValue(key: string) {\n    return this.dataForm.value[key].map((x, i) => x && this.permissionNameList[i]).filter(x => !!x);\n  }\n\n  /**\n   * Set form group based on roles\n   */\n  public setFormGroup() {\n    let formGroup = {};\n    let object = this;\n    this.currentPermissions.forEach(function (role) {\n      let label = object.convertHyphenUnderscore(role.name);\n      formGroup[label] = new FormArray(object.permissionNameList.map(x => new FormControl(role.permissions.indexOf(x) > -1)));\n    });\n\n    this.dataForm = this.formBuilder.group(formGroup);\n  }\n\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { HttpClient, HttpClientModule, HTTP_INTERCEPTORS } from '@angular/common/http';\nimport { AppInterceptor } from '../../shared/http/interceptor/interceptor';\nimport { PermissionsRouting } from './permissions.routing';\nimport {\n  SharedServicesAndComponentsModule\n} from '../../shared/shared-services-and-components-module/shared-services-and-components-module';\nimport { PermissionListingComponent } from './components/permission-listing/permission-listing.component';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    ReactiveFormsModule,\n    HttpClientModule,\n    PermissionsRouting,\n    SharedServicesAndComponentsModule\n  ],\n  declarations: [PermissionListingComponent],\n  entryComponents: [],\n  exports: [CommonModule],\n  providers: [\n    HttpClient,\n    { provide: HTTP_INTERCEPTORS, useClass: AppInterceptor, multi: true }\n  ]\n})\nexport class PermissionsModule { }\n","\nimport { ModuleWithProviders } from '@angular/core';\nimport { Routes, RouterModule } from '@angular/router';\nimport { PermissionListingComponent } from './components/permission-listing/permission-listing.component';\n\nconst routes: Routes = [\n    { path: '', component: PermissionListingComponent }\n];\n\nexport const PermissionsRouting: ModuleWithProviders = RouterModule.forChild(routes);\n","import { Injectable } from '@angular/core';\nimport { Auth } from '../../auth/auth';\nimport { ToastrService } from 'ngx-toastr';\nimport {\n  HttpRequest,\n  HttpHandler,\n  HttpEvent,\n  HttpInterceptor,\n  HttpResponse, HttpErrorResponse\n} from '@angular/common/http';\nimport { Observable } from 'rxjs';\nimport 'rxjs/add/operator/do';\nimport { BASE_URL } from '../../constants/constant';\n\n@Injectable()\nexport class AppInterceptor implements HttpInterceptor {\n  constructor(\n    private auth: Auth,\n    public toastr: ToastrService\n  ) { }\n  intercept(request: HttpRequest<any>, next: HttpHandler): Observable<HttpEvent<any>> {\n    let httpHeaders = this.getHeaders(this.auth.getUserLoginData());\n    request = request.clone({\n      setHeaders: httpHeaders\n    });\n    return next.handle(request).do(\n      succ => {\n        if (succ instanceof HttpResponse) {\n          this.handleSuccess(succ);\n        }\n      },\n      err => {\n        if (err instanceof HttpErrorResponse) {\n          this.handleError(request, next, err);\n        }\n      });\n  }\n\n  handleError(request, next, err) {\n    if (err.status === 401) {\n      this.handle401Error(request, next);\n    } else {\n      this.handleRequestError(err);\n    }\n  }\n\n  handleSuccess(succ) {\n    if (succ['body']['message'] !== undefined) {\n      this.toastr.success(succ['body']['message']);\n    }\n  }\n\n  private handle401Error(request: HttpRequest<any>, next: HttpHandler) {\n    let parentContext = this;\n    this.auth.refreshToken().then(\n      function (data) {\n        if (data) {\n          let httpHeaders = parentContext.getHeaders(parentContext.auth.getUserLoginData());\n          window.location.reload();\n        }\n      }\n    );\n  }\n\n  private handleRequestError(err) {\n    if (err['error']['message'] !== undefined) {\n      let errors = [];\n      let errorObject = err['error']['errors'];\n      for (let error in errorObject) {\n        if (errorObject.hasOwnProperty(error)) {\n          errors.push(errorObject[error]);\n        }\n      }\n\n      this.toastr.error(errors.join('<br>'), err['error']['message'], { enableHtml: true });\n\n    }\n  }\n\n\n  private getHeaders(userDetails) {\n    let headers = {};\n    let currentUser = this.auth.getUserLoginData();\n    if (currentUser) {\n      headers['Authorization'] = currentUser.token_type + ' ' + currentUser.access_token;\n    }\n    headers['domain'] = window.location.origin;\n    return headers;\n  }\n}\n"],"sourceRoot":""}